ReportDefinitions:
- reportName: MISEventLocalityWiseReport
  summary: Locality Wise report
  version: 1.0.0
  moduleName: prscp-services
  sourceColumns:
  - name: localityname
    label: report.prscp.localityname
    type: string
    source: prscp-services
    total: false
  - name: totalevents
    label: report.prscp.totalevents
    type: string
    source: prscp-services
    total: false
  - name: ongoingevents
    label: report.prscp.ongoingevents
    type: string
    source: prscp-services
    total: false
  - name: upcommingevents
    label: report.prscp.upcommingevents
    type: string
    source: prscp-services
    total: false
  - name: closedevents
    label: report.prscp.closedevents
    type: string
    source: prscp-services
    total: false
  - name: archivedevnets
    label: report.prscp.archivedevnets
    type: string
    source: prscp-services
    total: false
  additionalConfig:
    reportTitle: reports.prscp.MISSummaryReport.title
  query: select COALESCE(locality_name,'') localityname, count(1) totalevents, count((TO_TIMESTAMP(to_char(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS') between TO_TIMESTAMP(concat(to_char(start_date, 'YYYY-MM-DD'),' ',start_time), 'YYYY-MM-DD HH24:MI:SS') and TO_TIMESTAMP(concat(to_char(end_date, 'YYYY-MM-DD'),' ',end_time), 'YYYY-MM-DD HH24:MI:SS')) or null) as ongoingevents, count((TO_TIMESTAMP(to_char(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS') < TO_TIMESTAMP(concat(to_char(start_date, 'YYYY-MM-DD'),' ',start_time), 'YYYY-MM-DD HH24:MI:SS')) or null) as upcommingevents, count((TO_TIMESTAMP(to_char(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS') > TO_TIMESTAMP(concat(to_char(end_date, 'YYYY-MM-DD'),' ',end_time), 'YYYY-MM-DD HH24:MI:SS') and event_status<>'CANCELLED') or null) as closedevents,	count((TO_TIMESTAMP(to_char(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS') > TO_TIMESTAMP(concat(to_char(end_date, 'YYYY-MM-DD'),' ',end_time), 'YYYY-MM-DD HH24:MI:SS') and event_status<>'CANCELLED') or null) + count(event_status='CANCELLED' or null) as archivedevnets from egpr_event_detail where tenant_id=$tenantid and module_code=$moduleCode and DATE(to_char(TO_TIMESTAMP(created_time / 1000),'yyyy-mm-dd')) between DATE($fromDate) and DATE($toDate) and COALESCE(locality_name,'') = case when (Trim($localityName))<>'' then (Trim($localityName)) else COALESCE(locality_name,'') end group by tenant_id,module_code, COALESCE(locality_name,'')
  
- reportName: MISNumberOfEventReportReport
  summary: Number of Event Report Department Wise report
  version: 1.0.0
  moduleName: prscp-services
  sourceColumns:
  - name: departmentname
    label: report.prscp.departmentname
    type: string
    source: prscp-services
    total: false
  - name: totalevents
    label: report.prscp.totalevents
    type: string
    source: prscp-services
    total: false
  - name: ongoingevents
    label: report.prscp.ongoingevents
    type: string
    source: prscp-services
    total: false
  - name: upcommingevents
    label: report.prscp.upcommingevents
    type: string
    source: prscp-services
    total: false
  - name: closedevents
    label: report.prscp.closedevents
    type: string
    source: prscp-services
    total: false
  - name: archivedevnets
    label: report.prscp.archivedevnets
    type: string
    source: prscp-services
    total: false
  - name: uploadeddocument
    label: report.prscp.uploadeddocument
    type: string
    source: prscp-services
    total: false
  additionalConfig:
    reportTitle: reports.prscp.MISSummaryReport.title
  query: select COALESCE(a.organizer_department_name,'') as departmentname, count(1) totalevents, count((TO_TIMESTAMP(to_char(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS') between TO_TIMESTAMP(concat(to_char(a.start_date, 'YYYY-MM-DD'),' ',a.start_time), 'YYYY-MM-DD HH24:MI:SS') and TO_TIMESTAMP(concat(to_char(a.end_date, 'YYYY-MM-DD'),' ',a.end_time), 'YYYY-MM-DD HH24:MI:SS')) or null) as ongoingevents, count((TO_TIMESTAMP(to_char(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS') < TO_TIMESTAMP(concat(to_char(a.start_date, 'YYYY-MM-DD'),' ',a.start_time), 'YYYY-MM-DD HH24:MI:SS')) or null) as upcommingevents, count((TO_TIMESTAMP(to_char(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS') > TO_TIMESTAMP(concat(to_char(a.end_date, 'YYYY-MM-DD'),' ',a.end_time), 'YYYY-MM-DD HH24:MI:SS') and a.event_status<>'CANCELLED') or null) as closedevents, count((TO_TIMESTAMP(to_char(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS') > TO_TIMESTAMP(concat(to_char(a.end_date, 'YYYY-MM-DD'),' ',a.end_time), 'YYYY-MM-DD HH24:MI:SS') and a.event_status<>'CANCELLED') or null) + count(a.event_status='CANCELLED' or null) as archivedevnets, max(coalesce(b.uploaded_document,0)) as uploadeddocument  from egpr_event_detail as a left join (select event_detail_uuid, sum(json_array_length(uploaded_document)) as uploaded_document from egpr_library group by event_detail_uuid) as b on a.event_detail_uuid=b.event_detail_uuid  where a.tenant_id=$tenantid and a.module_code=$moduleCode and COALESCE(a.organizer_department_name,'') = case when $departmentName<>'' then $departmentName else COALESCE(a.organizer_department_name,'') end	and DATE(to_char(now() - interval '1 year','yyyy-mm-dd')) <= DATE(to_char(TO_TIMESTAMP(created_time / 1000),'yyyy-mm-dd')) group by a.tenant_id, a.module_code, COALESCE(a.organizer_department_name,'')
